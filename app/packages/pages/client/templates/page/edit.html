<template name="EditPage">
  <div class="box">
    <div class="box-header with-border">
      <h3 class="box-title">Edit page</h3>
      {{#if (can "update" page)}}
      <span style="float:right">
        {{> quickRemoveButton collection=getCol _id=page._id onSuccess=onSuccess class="btn btn-danger"}}
      </span>
      <section style="float:right">{{> breadcrumb}}</section>
      {{/if}}
    </div>
    <div class="box-body table-responsive">
      {{#if (can "update" page)}}
      {{> quickForm collection=getCol doc=page id="editPageForm" type="update" omitFields="createdBy" buttonContent="Update"}}
      {{/if}}
      <hr>
      {{#linkTo route="insertWidget" parent=page._id}}<i class="fa fa-plus"></i> New Widget{{/linkTo}}
      <div class="widgetList">
      {{> widgetList Widgets=Widgets editing=editings}}
      </div>
      {{#each Widgets}}
        <a name="{{_id}}">
          {{#if isEditing }}
            <div class="box box-warning box-solid">
              <div class="box-header with-border">
                <h3 class="box-title">Editing</h3>
              </div>
              <!-- /.box-header -->
              <div class="box-body">
                {{> Template.dynamic template=type data=this}}
                {{> EditWidget}}
              </div>
              <!-- /.box-body -->
            </div>
          {{else}}
            {{> Template.dynamic template=type data=this}}
          {{/if}}
        </a>
      {{/each}}
    </div>
  </div>
</template>

<template name="widgetList">
        <h4>Widgets</h4>
        
        <div class="box-body table-responsivesubmissionsAdminCalendar">
          <table id="items" class="table table-hover">
            <thead>
              <tr>
                <th>type</th>
                <th></th>
              </tr>
            </thead>
            <tbody>
              {{#each widgets}}
                <tr data-id='{{_id}}' class="widgetRow" data-listposition='{{listposition}}'>
                  <td><i class="fa fa-sort pull-right"></i></td>
                  <td>{{type}}</td>
                  {{#if (can "update" this)}}
                  {{debug}}
                    {{#if isEditing}}
                      <td class="alert alert-warning">
                            <button class="btn btn-info editButton" type="button">Edit</button>
                      </td>
                    {{else}}
                      <td>
                            <button class="btn btn-info editButton" type="button">Edit</button>
                      </td>
                    {{/if}}
                  {{/if}}
                </tr>
              {{/each}}
            </tbody>
          </table>
        </div>
</template>
